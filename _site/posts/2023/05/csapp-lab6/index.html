

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>CSAPP Lab6 ShellLab - Pai Peng</title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="Pai Peng">
<meta property="og:title" content="CSAPP Lab6 ShellLab">


  <link rel="canonical" href="http://localhost:4000/posts/2023/05/csapp-lab6/">
  <meta property="og:url" content="http://localhost:4000/posts/2023/05/csapp-lab6/">



  <meta property="og:description" content="  Reading 8.1 - 8.8 of CSAPP: 3e and the writeup can be very helpful;  Make sure you understand the content in the slides very carefully, especially 15-ecf-signals.pdf;  Read the writeup very carefully.">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2023-05-24T00:00:00-07:00">






  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "http://localhost:4000/images/site-logo.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Pai Peng",
      "url" : "http://localhost:4000",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Pai Peng Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="http://localhost:4000/images/apple-touch-icon-57x57.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="60x60" href="http://localhost:4000/images/apple-touch-icon-60x60.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="76x76" href="http://localhost:4000/images/apple-touch-icon-76x76.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="120x120" href="http://localhost:4000/images/apple-touch-icon-120x120.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="152x152" href="http://localhost:4000/images/apple-touch-icon-152x152.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/images/apple-touch-icon-180x180.png?v=M44lzPylqQ">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:4000/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16">
<link rel="manifest" href="http://localhost:4000/images/manifest.json?v=M44lzPylqQ">
<link rel="mask-icon" href="http://localhost:4000/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000">
<link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="http://localhost:4000/images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="http://localhost:4000/images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="http://localhost:4000/assets/css/academicons.css"/>

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">Pai Peng</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/cv/">CV</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/portfolio/">Projects</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/year-archive/">Blog Posts</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/life/">Life & Interest</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/images/bio-photo.png" class="author__avatar" alt="Pai Peng">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Pai Peng</h3>
    <p class="author__bio">MSc Computer Engineering @ The University of Edinburgh</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> United Kingdom</li>
      
      
      
      
      
       
      
      
      
      
        <li><a href="https://www.linkedin.com/in/paipeng6"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
        <li><a href="https://instagram.com/https://www.instagram.com/pi.thomas.66/"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
      
      
      
      
        <li><a href="https://github.com/Altman-S"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="CSAPP Lab6 ShellLab">
    <meta itemprop="description" content="  Reading 8.1 - 8.8 of CSAPP: 3e and the writeup can be very helpful;  Make sure you understand the content in the slides very carefully, especially 15-ecf-signals.pdf;  Read the writeup very carefully.">
    <meta itemprop="datePublished" content="May 24, 2023">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">CSAPP Lab6 ShellLab
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  3 minute read
	
</p>
          
        
        
        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2023-05-24T00:00:00-07:00">May 24, 2023</time></p>
        
        
             
        
    
        </header>
      

      <section class="page__content" itemprop="text">
        <ol>
  <li>Reading <code class="language-plaintext highlighter-rouge">8.1 - 8.8</code> of <code class="language-plaintext highlighter-rouge">CSAPP: 3e</code> and the writeup can be very helpful;</li>
  <li>Make sure you understand the content in the slides very carefully, especially 15-ecf-signals.pdf;</li>
  <li>Read the writeup very carefully.</li>
</ol>

<h2 id="working-on-the-lab">Working on the lab</h2>

<ol>
  <li>Some snippets in lecture slides and book are very similar to the code for the lab, you can just copy it and change some details;</li>
  <li>The writeup provides strategies for most of the tricky parts in the lab, it can guide you through the lab, so make sure you read the writeup very carefully;</li>
  <li>Make good use of man page.</li>
</ol>

<h2 id="some-questions">Some questions</h2>

<ol>
  <li>Why the child process cannot use printf()?</li>
</ol>

<p>I tried to use <code class="language-plaintext highlighter-rouge">printf()</code> to track the child process and find out what happened inside, but there was no output for the child process on the console.</p>

<p>The reason is here:</p>

<p>When a child process is created, it inherits a copy of the parent process’s file descriptors, including the standard output file descriptor (<code class="language-plaintext highlighter-rouge">stdout</code>). However, the output buffering state is also inherited. By default, <code class="language-plaintext highlighter-rouge">stdout</code> is line-buffered, meaning the output is stored in a buffer until a newline character (<code class="language-plaintext highlighter-rouge">'\n'</code>) is encountered or the buffer is full.</p>

<p>In the case of a child process, if the output buffer is not flushed before the <code class="language-plaintext highlighter-rouge">fork()</code> call or if the child process doesn’t explicitly flush the buffer, the buffered output will also be duplicated in the child process. This means that the child process will have its own copy of the buffered output, separate from the parent process.</p>

<p>If the child process attempts to print using <code class="language-plaintext highlighter-rouge">printf()</code>, the output will go to its own copy of the output buffer. However, because the buffer is not automatically flushed, the output may not immediately appear on the console or in the output stream.</p>

<p>To address this, you can explicitly flush the output buffer before the <code class="language-plaintext highlighter-rouge">fork()</code> call or use functions like <code class="language-plaintext highlighter-rouge">fflush(stdout)</code> to manually flush the buffer in both the parent and child processes. This ensures that the buffered output is immediately visible.</p>

<p>Additionally, you can use functions like <code class="language-plaintext highlighter-rouge">write()</code> instead of <code class="language-plaintext highlighter-rouge">printf()</code> for immediate output, as <code class="language-plaintext highlighter-rouge">write()</code> writes directly to the file descriptor without buffering.</p>

<ol>
  <li>How to check the process is no longer the foreground process in this lab?</li>
</ol>

<p>In <code class="language-plaintext highlighter-rouge">waitfg()</code>, we use a busy loop around the sleep function (0.1s) to check the existence of the current foreground process (<code class="language-plaintext highlighter-rouge">check whether the current job id is in the job list</code>). If the fg process is terminated, the related job will be deleted from the job list and the shell program will end the busy sleep loop and immediately return.</p>

<p>To be more specific, when the child process is terminated, <code class="language-plaintext highlighter-rouge">waitpid()</code> will be automatically called and the parent process will reap the child process and delete its job id in the job list, as <code class="language-plaintext highlighter-rouge">deletejob()</code> in <code class="language-plaintext highlighter-rouge">sigchld_hanlder()</code>.</p>

<ol>
  <li>For trace05, in my implementation, other processes will wait for my running background process, but it’s not for the <code class="language-plaintext highlighter-rouge">tshref</code> (run other jobs immediately without waiting). Why is there a difference?</li>
</ol>

<p>By default (when options = 0), <code class="language-plaintext highlighter-rouge">waitpid()</code> suspends execution of the calling process until a child process in its wait set terminates.</p>

<p>If we want to return it immediately, we need to set options as <code class="language-plaintext highlighter-rouge">WNOHANG | WUNTRACED</code> (you can check these options meaning in the book).</p>

        
      </section>

      <footer class="page__meta">
        
        


  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#csapp" class="page__taxonomy-item" rel="tag">csapp</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#self-learning" class="page__taxonomy-item" rel="tag">self-learning</a>
    
    </span>
  </p>




      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/posts/2023/05/csapp-lab6/" class="btn btn--twitter" title="Share on Twitter"><i class="fab fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/posts/2023/05/csapp-lab6/" class="btn btn--facebook" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/posts/2023/05/csapp-lab6/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fab fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://localhost:4000/posts/2023/02/csapp-lab3/" class="pagination--pager" title="CSAPP Lab3 AttackLab
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/posts/2023/02/csapp-lab3/" rel="permalink">CSAPP Lab3 AttackLab
</a>
      
    </h2>
    
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  5 minute read
	
</p>
    

        
         <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2023-02-06T00:00:00-08:00">February 06, 2023</time></p>
        

    
    <p class="archive__item-excerpt" itemprop="description"><p>Compared with <code class="language-plaintext highlighter-rouge">DataLab</code> and <code class="language-plaintext highlighter-rouge">BombLab</code>, this is a much easier lab: as it is only based on one lecture and the code you need to go through is relatively short. The only thing that can be confusing is byte ordering: when you need to reverse the bytes and when you should not.</p>

</p>
    
    
    

  </article>
</div>

        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/posts/2022/10/csapp-lab2/" rel="permalink">CSAPP Lab2 BombLab
</a>
      
    </h2>
    
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  1 minute read
	
</p>
    

        
         <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2022-10-15T00:00:00-07:00">October 15, 2022</time></p>
        

    
    <p class="archive__item-excerpt" itemprop="description"><p>In this lab, we need to understand how the assembly code works. Somtimes, we need to have a overview of all the assembly codes without paying more attention to details. We should try to understand the logic of each command in detail, not command details. Since there are so many registers involved and as they are not given meaningful name, you will quickly get overwhelmed.</p>

</p>
    
    
    

  </article>
</div>

        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/posts/2022/10/begin/" rel="permalink">Begin The Journey
</a>
      
    </h2>
    
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  less than 1 minute read
	
</p>
    

        
         <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2022-10-01T00:00:00-07:00">October 01, 2022</time></p>
        

    
    <p class="archive__item-excerpt" itemprop="description"><p>Welcome to my blog, where I document my self-learning projects and share insights on new technologies. Join me on this exciting journey of continuous growth and discovery.</p>

</p>
    
    
    

  </article>
</div>

        
      </div>
    </div>
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<a href="/sitemap/">Sitemap</a>
<!-- end custom footer snippets -->

        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/Altman-S"><i class="fab fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Pai Peng. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>






  </body>
</html>

